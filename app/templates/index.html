<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Netops Toolkit - IP Translator</title>
</head>
<body>
    
    
    <p>Network IP Address Translator</p>

    <label for="inputText">
        <strong>Enter text with IP addresses:</strong>
    </label>
    <br>
    <textarea
        id="inputText"
        rows="6"
        cols="80"
        placeholder="Paste your text here... IP addresses like 192.168.1.1 will be automatically translated to show hostname and interface information."></textarea>
    <div id="loadingIndicator" style="display: none;">
        Translating...
    </div>

    <br><br>

    <label>
        <strong>Translated Output:</strong>
        <button id="copyButton" style="margin-left: 10px; padding: 4px 8px; cursor: pointer;" onclick="copyTranslatedOutput()">Copy</button>
    </label>
    <br>
    <div id="outputArea" style="border: 1px solid #ccc; padding: 10px; min-height: 100px; font-family: 'Consolas', monospace; line-height: 1.2;">
        <em>Your translated text will appear here...</em>
    </div>

    <br><br>

   

    <!-- Tooltip container -->
    <div id="tooltip" style="position: absolute; background: #333; color: white; padding: 10px; border-radius: 5px; display: none; z-index: 1000;"></div>
    <script>
        let timeoutId;
        const inputText = document.getElementById('inputText');
        const outputArea = document.getElementById('outputArea');
        const loadingIndicator = document.getElementById('loadingIndicator');
        const tooltip = document.getElementById('tooltip');

        // Debounced translation function
        function scheduleTranslation() {
            clearTimeout(timeoutId);
            timeoutId = setTimeout(translateText, 500); // Wait 500ms after user stops typing
        }

        async function translateText() {
            const text = inputText.value.trim();

            if (!text) {
                outputArea.innerHTML = '<em>Your translated text will appear here...</em>';
                return;
            }

            loadingIndicator.style.display = 'block';

            try {
                const response = await fetch(`/api/translate-ip?text=${encodeURIComponent(text)}`);
                const data = await response.json();

                outputArea.innerHTML = data.translated_text || text;

                // Attach event listeners to enhanced IPs
                attachTooltipHandlers();

            } catch (error) {
                console.error('Translation error:', error);
                outputArea.innerHTML = text;
            } finally {
                loadingIndicator.style.display = 'none';
            }
        }

        function attachTooltipHandlers() {
            const enhancedIPs = document.querySelectorAll('.ip-enhanced');

            enhancedIPs.forEach(element => {
                element.addEventListener('mouseenter', showTooltip);
                element.addEventListener('mouseleave', hideTooltip);
                element.addEventListener('click', handleIPClick);
            });
        }

        function showTooltip(event) {
            const element = event.target;
            const tooltipDataStr = element.getAttribute('data-tooltip').replace(/&quot;/g, '"');
            const tooltipData = JSON.parse(tooltipDataStr);
            const mgmtIP = element.getAttribute('data-mgmt-ip');

            const tooltipContent = `
                <div>
                    <strong>${tooltipData.hostname}</strong><br>
                    <strong>Interface:</strong> ${tooltipData.interface_name}<br>
                    <strong>Description:</strong> ${tooltipData.interface_description}<br>
                    <strong>Management IP:</strong> ${mgmtIP}<br>
                    <strong>Vendor:</strong> ${tooltipData.device_vendor}<br>
                    <strong>Status:</strong> ${tooltipData.interface_status}<br>
                    <a href="ssh://${mgmtIP}" onclick="event.stopPropagation();">SSH to ${mgmtIP}</a>
                </div>
            `;

            tooltip.innerHTML = tooltipContent;
            tooltip.style.display = 'block';

            // Position tooltip
            const rect = element.getBoundingClientRect();
            tooltip.style.left = rect.left + 'px';
            tooltip.style.top = (rect.bottom + 10) + 'px';
        }

        function hideTooltip() {
            tooltip.style.display = 'none';
        }

        function handleIPClick(event) {
            const element = event.target;
            const mgmtIP = element.getAttribute('data-mgmt-ip');

            // Copy management IP to clipboard
            navigator.clipboard.writeText(mgmtIP).then(() => {
                // Brief visual feedback
                element.style.backgroundColor = 'yellow';
                setTimeout(() => {
                    element.style.backgroundColor = '';
                }, 200);
            });
        }

        function copyTranslatedOutput() {
            const outputArea = document.getElementById('outputArea');
            // Get the text content without HTML tags
            const textToCopy = outputArea.innerText || outputArea.textContent;

            navigator.clipboard.writeText(textToCopy).then(() => {
                // Visual feedback on the copy button
                const copyButton = document.getElementById('copyButton');
                const originalText = copyButton.textContent;
                copyButton.textContent = 'Copied!';
                copyButton.style.backgroundColor = '#4caf50';
                copyButton.style.color = 'white';

                setTimeout(() => {
                    copyButton.textContent = originalText;
                    copyButton.style.backgroundColor = '';
                    copyButton.style.color = '';
                }, 1000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy to clipboard');
            });
        }

        // Event listeners
        inputText.addEventListener('input', scheduleTranslation);
        inputText.addEventListener('paste', () => {
            setTimeout(scheduleTranslation, 10); // Small delay to let paste complete
        });

        // Hide tooltip when clicking elsewhere
        document.addEventListener('click', (event) => {
            if (!event.target.closest('.ip-enhanced')) {
                hideTooltip();
            }
        });

        // Sample text for demonstration
        inputText.addEventListener('focus', function() {
            if (this.value === '') {
                this.placeholder = 'Try pasting: "Traffic from 192.168.1.1 to 10.0.0.1 shows high latency. Check interface on 172.16.0.1 for errors."';
            }
        });

        inputText.addEventListener('blur', function() {
            this.placeholder = 'Paste your text here... IP addresses like 192.168.1.1 will be automatically translated to show hostname and interface information.';
        });
    </script>
</body>
</html>